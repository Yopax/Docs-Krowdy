---
sidebar_position: 4
---

# Ejercicio PrÃ¡ctico
`Ejercicio Propuesto:`
Realizar una Chrome extensiÃ³n que permita realizar scraping de informaciÃ³n de productos(Verduras y Frutas) en la pÃ¡gina web de **[Plaza Vea](https://www.plazavea.com.pe/frutas-y-verduras)**. 
## Estructura del Carpetas

Este documento describe la estructura de carpetas y archivos para el proyecto de la extensiÃ³n de Chrome "VEA-SCRAPER-DARLI". Cada carpeta y archivo tiene un propÃ³sito especÃ­fico para la funcionalidad y configuraciÃ³n de la extensiÃ³n. [Front Matter](https://jekyllrb.com/docs/front-matter/):

```plaintext
ðŸ“‚ VEA-SCRAPER-DARLI
â”œâ”€â”€ ðŸ“‚ dist                     
â”œâ”€â”€ ðŸ“‚ node_modules            
â”œâ”€â”€ ðŸ“‚ src                      
â”‚   â”œâ”€â”€ background.js         
â”‚   â”œâ”€â”€ content.js              
â”‚   â””â”€â”€ popup.js                
â”œâ”€â”€ ðŸ“‚ static                  
â”‚   â”œâ”€â”€ icon1.svg           
â”‚   â”œâ”€â”€ logo.png                
â”‚   â”œâ”€â”€ manifest.json         
â”‚   â”œâ”€â”€ popup.css              
â”‚   â””â”€â”€ popup.html                               
â”œâ”€â”€ package-lock.json           
â”œâ”€â”€ package.json                
â”œâ”€â”€ README.md                   
â”œâ”€â”€ webpack.common.js           
â”œâ”€â”€ webpack.dev.js              
â””â”€â”€ webpack.prod.js                  
```
### dist
Carpeta que contiene los archivos finales generados para la distribuciÃ³n de la extensiÃ³n. Webpack compila el cÃ³digo aquÃ­ para que estÃ© listo para la producciÃ³n.
Regular Markdown links are supported, using url paths or relative file paths.
### node_modules
Carpeta que contiene todas las dependencias y mÃ³dulos instalados mediante npm. Estos mÃ³dulos son necesarios para que el proyecto funcione correctamente.
### src
Contiene el cÃ³digo fuente de la extensiÃ³n. Incluye los scripts principales que manejan la lÃ³gica de fondo, la interacciÃ³n con la pÃ¡gina y la interfaz de usuario del popup.
- background.js: Script que se ejecuta en segundo plano para manejar tareas persistentes, como escuchar eventos y comunicar la extensiÃ³n con las pÃ¡ginas web.
- content.js: Script de contenido que se inyecta en la pÃ¡gina web y contiene la lÃ³gica de scraping para interactuar con el DOM de la pÃ¡gina.
- popup.js: Script que maneja la lÃ³gica y funcionalidad del popup de la extensiÃ³n, incluyendo botones y eventos.
### static
Carpeta que contiene archivos estÃ¡ticos, como Ã­conos y el archivo de configuraciÃ³n de la extensiÃ³n, asÃ­ como los archivos para el popup.

- icon1.svg: Icono en formato SVG utilizado para representar la extensiÃ³n en la barra de Chrome y en la tienda de Chrome.
- logo.png: Imagen en formato PNG que sirve como logo de la extensiÃ³n.
- manifest.json: Archivo de configuraciÃ³n principal de la extensiÃ³n que define permisos, scripts, Ã­conos, etc.
- popup.css: Archivo CSS que define los estilos visuales para la interfaz del popup.
- popup.html: Archivo HTML que estructura la interfaz del popup mostrado al usuario.
### package-lock.json
Archivo de bloqueo que garantiza la integridad de versiones de las dependencias instaladas. Es generado automÃ¡ticamente por npm.
### package.json
Archivo de configuraciÃ³n para npm. Define las dependencias del proyecto, scripts Ãºtiles para el desarrollo, y metadatos bÃ¡sicos del proyecto.
### README.md
Archivo de documentaciÃ³n general del proyecto. Incluye una introducciÃ³n al proyecto, instrucciones de instalaciÃ³n y uso, y cualquier otra informaciÃ³n relevante para los desarrolladores y usuarios.
### webpack.common.js
ConfiguraciÃ³n comÃºn de Webpack que incluye reglas y plugins que se aplican tanto en el entorno de desarrollo como en producciÃ³n.
### webpack.dev.js
ConfiguraciÃ³n de Webpack especÃ­fica para el entorno de desarrollo. Incluye ajustes como el modo development y el uso de herramientas para debugging.
### webpack.prod.js
ConfiguraciÃ³n de Webpack para el entorno de producciÃ³n. Incluye optimizaciones y ajustes como el modo production para mejorar el rendimiento y reducir el tamaÃ±o de los archivos generados.

## Manifest
```jsx title="/static/manifest.json"
{
    "name": "Scraper Vea 2",
    "description": "This extension will scrape the plaza vea website",
    "version": "1.1",
    "manifest_version": 3,
    "content_scripts": [
      {
        "matches": ["https://www.plazavea.com.pe/*"],
        "js": ["content.js"]
      }
    ],
    "action":{
      "default_popup": "popup.html",
      "default_icon": "logo.png"
    },
    "permissions": ["activeTab", "scripting"]
  }
```
En este archivo JSON, se describen los atributos capacidades y configuraciÃ³n. Por ejemplo, la mayorÃ­a de los archivos de manifiesto contienen una clave "action" que declara la imagen que Chrome debe usar como Ã­cono de acciÃ³n de la extensiÃ³n y la pÃ¡gina HTML para mostrar en una ventana emergente cuando cuando se hace clic en el Ã­cono de acciÃ³n de la extensiÃ³n.
## HTML
El archivo popup.html es la estructura de la extension la ui que se mostrara alos usuarios, en este documento tambiem definimos los estilos mediante clases(class="") creados en el popup.css. Asimismo definimos la logica de los botones o inputs mediante ids(id=""). 
```jsx title="static/popup.html"
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraper Vea</title>
    <link rel="stylesheet" type="text/css" href="popup.css">
</head>
<body>
    <!-- Header(img logo - title extension)-->
    <div class="divheader">
        <img src="logo.png" alt="logo">
        <div>
            <h2 class="titleextension">SCRAPER VEA</h2>
            <a class="autor" href="https://speed-silk.vercel.app/" target="_blank">By: Darli Barreto</a>
        </div>
    </div>
    <!-- Disclaimer(icon - description discleaimer)-->
    <div class="divdisclaimer">
        <img src="icon1.svg" alt="icon disclaimer">
        <h2 class="descriptdiscleimer">ExtensiÃ³n creada con fines educativos para demostrar tÃ©cnicas de scraping web.
        </h2>
    </div>
    <div class="divinputdata">
        <p class="descriptinputdata">Nombre del Archivo</p>
        <input class="inputdata" id="filenameInput" placeholder="Nombre del archivo para guardar los datos."
            type="text">
        <p class="recordatorioinputdata">Sus datos scrapeados se guardaran en formato .JSON</p>
    </div>
    <div class="divbuttons">
        <button class="playbutton" id="scrapeButton">Iniciar Scraping</button>
        <button class="downloadbutton" id="downloadButton">Descargar JSON</button>
    </div>
    <div class="feedback" id="feedback"></div>
    <div class="output" id="output"></div>
    <script src="popup.js"></script>
</body>
</html>
```
## JavaScript
Este cÃ³digo realiza scraping en una pÃ¡gina activa de Chrome, extrae y muestra datos de productos en la interfaz de la extensiÃ³n y permite descargarlos en JSON.

### LÃ³gica del botÃ³n: Iniciar Scraping
Todo comienza con este bloque de cÃ³digo que escucha el evento de "click" en scrapeButton y ejecuta una funciÃ³n anÃ³nima asÃ­ncrona.
```jsx title="src/popup.js"
document.getElementById("scrapeButton").addEventListener("click", async () => {
  .....
}
```
Obtiene referencias a los elementos feedback y output para actualizar mensajes y mostrar resultados.
```jsx title="src/popup.js"
const feedback = document.getElementById("feedback");
const output = document.getElementById("output");
```
Muestra "Realizando scraping..." para indicar que el proceso ha comenzado.
Limpia el contenido de output para asegurarse de que no queden resultados anteriores.
```jsx title="src/popup.js"
feedback.textContent = "Realizando scraping...";
output.innerHTML = "";
```
Usa la API chrome.tabs.query para obtener la pestaÃ±a activa en la ventana actual y guarda la informaciÃ³n en tab.
```jsx title="src/popup.js"
const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
```
Utiliza chrome.scripting.executeScript para ejecutar la funciÃ³n scrapeProducts en la pestaÃ±a actual.
results contiene el resultado del scraping.
```jsx title="src/popup.js"
chrome.scripting.executeScript(
  {
    target: { tabId: tab.id },
    func: scrapeProducts,
  },
  (results) => { ... }
);
```
Extrae los datos de los productos de results[0].result.
Si no se encontraron productos, muestra un mensaje y oculta el botÃ³n de descarga.
Si se encuentran productos, muestra el mensaje "Scraping completado", genera el HTML para cada producto y lo agrega a output.
```jsx title="src/popup.js"
const data = results[0].result;
if (data.length === 0) { ... } else { ... }
```
Muestra el botÃ³n de descarga y le asigna un evento onclick para que descargue los datos en formato JSON.
```jsx title="src/popup.js"
document.getElementById("downloadButton").style.display = "inline";
document.getElementById("downloadButton").onclick = () => downloadJSON(data);
```
### LÃ³gica del scraping: scrapeProducts
Esta funciÃ³n es la encargada de realizar el scraping en la pÃ¡gina activa y extraer los datos de los productos.
```jsx title="src/popup.js"
async function scrapeProducts() {
```
dentro de la funcion anterior se define una funciÃ³n delay que devuelve una promesa resuelta despuÃ©s de time milisegundos.
```jsx title="src/popup.js"
function delay(time) {
  return new Promise((resolve) => setTimeout(resolve, time));
}
```
Espera 200 ms para dar tiempo a que el contenido de la pÃ¡gina se cargue completamente.
```jsx title="src/popup.js"
await delay(200);
```
Usa un selector para obtener todos los elementos de las tarjetas de productos (cards).
Convierte NodeList en un array para facilitar su manipulaciÃ³n.
```jsx title="src/popup.js"
let cards = document.querySelectorAll("div.showcase-grid>div> .Showcase__content");
cards = [...cards];
```
Recorre cada tarjeta y extrae los detalles del producto:
name: Nombre del producto.
sellerName: Nombre del vendedor.
salePrice: Precio de venta.
salePriceDes: Precio con descuento.
priceTag: Etiqueta de precio (porcentaje de descuento).
Si un valor no se encuentra, se asigna un texto por defecto, como "Nombre no encontrado".
```jsx title="src/popup.js"
const products = cards.map((el) => { ... });
```
Retorna el array products con los detalles de cada producto encontrado.
```jsx title="src/popup.js"
return products;
```
### LÃ³gica del botÃ³n de descarga: downloadJSON
Esta funciÃ³n permite descargar los datos extraÃ­dos en un archivo JSON con el nombre especificado por el usuario.
```jsx title="src/popup.js"
function downloadJSON(data) {
```
dentro de la funcion anterior se obtiene el nombre del archivo desde filenameInput. Si no se ingresa un nombre, usa "testdarli" como predeterminado.
```jsx title="src/popup.js"
const filenameInput = document.getElementById("filenameInput");
const filename = filenameInput.value.trim() || "testdarli";
```
Crea un Blob con los datos en formato JSON.
Genera una URL para el Blob y simula un clic en un enlace a para descargar el archivo.
Usa URL.revokeObjectURL para liberar memoria despuÃ©s de la descarga.
```jsx title="src/popup.js"
const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
const url = URL.createObjectURL(blob);
const a = document.createElement("a");
a.href = url;
a.download = `${filename}.json`;
a.click();
URL.revokeObjectURL(url);
```
### Codigo Completo

```jsx title="src/popup.js"
document.getElementById("scrapeButton").addEventListener("click", async () => {
  const feedback = document.getElementById("feedback");
  const output = document.getElementById("output");

  feedback.textContent = "Realizando scraping...";
  output.innerHTML = "";

  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
  chrome.scripting.executeScript(
    {
      target: { tabId: tab.id },
      func: scrapeProducts,
    },
    (results) => {
      const data = results[0].result;
      if (data.length === 0) {
        feedback.textContent = "No se encontraron productos.";
        document.getElementById("downloadButton").style.display = "none";
      } else {
        feedback.textContent = "Scraping completado.";
        output.innerHTML = data
          .map(
            (product, i) =>
              `<div class="divcardgeneral">
                  <p class="pre">Producto scrapeado nÂ°:${i + 1}</p>
                  <h2 class="letrab">${product.name}</h2>
                  <p class="for">${product.sellerName}</p>
                  <div class="divcardsecundary">
                   <p class="price">${product.salePrice}</p>
                   <div class="descuento">
                   <p class="pricedes">${product.salePriceDes}</p>
                   <p class="pricetag">${product.priceTag}</p>
                   </div>
                  </div>
                 </div>`
          )
          .join("");
        document.getElementById("downloadButton").style.display = "inline";
        document.getElementById("downloadButton").onclick = () =>
          downloadJSON(data);
      }
    }
  );
});
```

